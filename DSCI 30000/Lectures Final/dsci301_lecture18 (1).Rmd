---
title: "dsci30100_lecture18v2.0"
author: "W. Golik.  Content provided by Sandeep Shayini - used with permission"
date: "11/07/2022"
output: html_document
---

# BIKE SHARING EXPLORATORY DATA ANALYSIS:  LINEAR REGRESSIONS

```{r}
library(tidyverse)
```


# Introduction
Bike sharing systems are new generation of traditional bike rentals where whole process from membership, rental and return back has become automatic. Through these systems, user is able to easily rent a bike from a particular position and return back at another position. Currently, there are about over 500 bike-sharing programs around the world which is composed of over 500 thousands bicycles. Today, there exists great interest in these systems due to their important role in traffic, environmental and health issues.

Apart from interesting real world applications of bike sharing systems, the characteristics of data being generated by these systems make them attractive for the research. Opposed to other transport services such as bus or subway, the duration of travel, departure and arrival position is explicitly recorded in these systems. This feature turns bike sharing system into a virtual sensor network that can be used for sensing mobility in the city. Hence, it is expected that most of important events in the city could be detected via monitoring these data.

# How do we get the data file?  
From https://www.rpubs.com/shayini/bike_sharing
Also check:  https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset

Capital Bikeshare, a program jointly
owned and sponsored by the District of Columbia and Arlington County, VA and operated by Alta Bicycle
Share, Inc., offers short-term use of more than 1,500 bicycles to registered members and day-pass users
at more than 165 stations in the District of Columbia and Arlington County.


```{r}
day <- read.csv("day.csv")
bk_sh_dy <- day
head(bk_sh_dy)

```




```{r}
head(bk_sh_dy)
dim(bk_sh_dy)
names(bk_sh_dy)
sample_n(bk_sh_dy, 30)
```

```{r}

summary(bk_sh_dy)
str(bk_sh_dy)
```




# Attribute Information:
instant: record index

dteday: date

season: season (1:spring, 2:summer, 3:fall, 4:winter)

yr: year (0: 2011, 1:2012)

mnth: month ( 1 to 12)

holiday: weather day is holiday or not (extracted from http://dchr.dc.gov/page/holiday-schedule)

weekday: day of the week

workingday: if day is neither weekend nor holiday is 1, otherwise is 0.

weathersit:

1: Clear, Few clouds, Partly cloudy

2: Mist and Cloudy, Mist and Broken clouds, Mist and Few clouds, Mist

3: Light Snow, Light Rain and Thunderstorm and Scattered clouds, Light Rain and Scattered clouds

4: Heavy Rain and Ice Pallets and Thunderstorm and Mist, Snow and Fog

temp: Normalized temperature in Celsius. The values are divided to 41 (max)

atemp: Normalized feeling temperature in Celsius. The values are divided to 50 (max)

hum: Normalized humidity. The values are divided to 100 (max)

windspeed: Normalized wind speed. The values are divided to 67 (max)

casual: count of casual users

registered: count of registered users

cnt: count of total rental bikes including both casual and registered


```{r}
ggplot(day) + 
  geom_point(mapping = aes(x = instant, y=temp)) 

ggplot(day) + 
  geom_point(mapping = aes(x = instant, y=cnt)) 

ggplot(day) + 
  geom_point(mapping = aes(x = instant, y=windspeed)) 

```




```{r}
library(dplyr)    #to use select(), arrange(), etc...
library(ggplot2)
library(stats)


#here we 

bk_sh_dy$season <- factor(  format(bk_sh_dy$season, format="%A"),
                          levels = c("1", "2","3","4") , labels =              c("Spring","Summer","Fall","Winter"))
   table(bk_sh_dy$season)
   
```
```{r}
bk_sh_dy$holiday <- factor(format(bk_sh_dy$holiday, format="%A"),
                          levels = c("0", "1") , labels = c("Working Day","Holiday"))
table(bk_sh_dy$holiday)
```


```{r}
bk_sh_dy$weathersit <- factor(format(bk_sh_dy$weathersit, format="%A"),
                          levels = c("1", "2","3","4") , 
               labels = c("Good:Clear/Sunny","Moderate:Cloudy/Mist","Bad: Rain/Snow/Fog","Worse: Heavy Rain/Snow/Fog"))
table(bk_sh_dy$weathersit)
```

```{r}
bk_sh_dy$yr <- factor(format(bk_sh_dy$yr, format="%A"),
                          levels = c("0", "1") , labels = c("2011","2012"))
table(bk_sh_dy$yr)
```

Now:
# Updated Attributes:
We create new attributes to denormalize the actual values, since the normalized values were very low and factorized the categorical attributes.

actual_temp: Converted normalized temperature in Celsius

actual_windspeed: Converted normalized windspeed

actual_humidity: Converted normalized humidity

actual_feel_temp: Converted normalized feeled temperature in Celsius

mean_acttemp_feeltemp: Created a mean of actual temperature and feel temperature

```{r}
bk_sh_dy$actual_temp <- bk_sh_dy$temp*41
bk_sh_dy$actual_feel_temp <- bk_sh_dy$atemp*50
bk_sh_dy$actual_windspeed <- bk_sh_dy$windspeed*67
bk_sh_dy$actual_humidity <- bk_sh_dy$hum*100
bk_sh_dy$mean_acttemp_feeltemp <- (bk_sh_dy$actual_temp+bk_sh_dy$actual_feel_temp)/2
str(bk_sh_dy)
head(bk_sh_dy)
```
# Exploratory Analysis with Plots
```{r}
h <- hist(bk_sh_dy$cnt, breaks = 50, ylab = 'Frequency of Rental', 
          xlab = 'Total Bike Rental Count', main = 'Distribution of Total Bike Rental Count', col = 'blue' )
#h


xfit <- seq(min(bk_sh_dy$cnt),max(bk_sh_dy$cnt), length = 50)
str(xfit)
yfit <- dnorm(xfit, mean = mean(bk_sh_dy$cnt),sd=sd(bk_sh_dy$cnt))
yfit
yfit <- yfit*diff(h$mids[1:2])*length(bk_sh_dy$cnt)
lines(xfit,yfit, col='red', lwd= 3)
```
Firstly, we observed how the response variable Total Bike Rentals (cnt) is distributed.

From the histogram above, it seems that the number of total rented bikes follow a nearly normal distribution.The mean and variance of distribution are the same, and when the mean is getting larger, distribution approximates a normal distribution.

Next, we looked at the relationship between the response variable and each explanatory variable. We selected few plots with patterns as shown below.

```{r}
par(mfcol=c(2,2))

 boxplot(bk_sh_dy$cnt ~ bk_sh_dy$season,
        data = bk_sh_dy,
        main = "Total Bike Rentals Vs Season",
        xlab = "Season",
        ylab = "Total Bike Rentals",
        col = c("coral", "coral1", "coral2", "coral3")) 


 boxplot(bk_sh_dy$cnt ~ bk_sh_dy$holiday,
        data = bk_sh_dy,
        main = "Total Bike Rentals Vs Holiday/Working Day",
        xlab = "Holiday/Working Day",
        ylab = "Total Bike Rentals",
        col = c("pink", "pink1", "pink2", "pink3")) 

boxplot(bk_sh_dy$cnt ~ bk_sh_dy$weathersit,
        data = bk_sh_dy,
        main = "Total Bike Rentals Vs Weather Situation",
        xlab = "Weather Situation",
        ylab = "Total Bike Rentals",
        col = c("purple", "purple1", "purple2", "purple3")) 


plot(bk_sh_dy$instant, bk_sh_dy$cnt, type = "p",
     main = "Total Bike Rentals Vs DateDay",
     xlab = "Year",
     ylab = "Total Bike Rentals",
     col  = "orange")
```

The plot shows the relationship between Total Bike Rentals(cnt) variable and season. The average numbers of bike rentals are the highest during summer and fall.

The plot shows the relationship between Total Bike Rentals(cnt) variable and holiday. We can see that the average number of bike rentals on working day is higher than holiday.

The plot shows the relationship between Total Bike Rentals(cnt) variable and weather. There is a clearly decreasing trend of bike rentals when weather is bad.

The plot shows the relationship between Total Bike Rentals(cnt) variable and Year. We can see that the overall trend increased during the two-year time span. And within each year, there are huge amount of bike rentals during summer and fall seasons.


#Distribution of Numerical Variables
```{r}
par(mfrow=c(2,2))
summary(bk_sh_dy$actual_temp)

plot(bk_sh_dy$actual_temp, bk_sh_dy$cnt ,type = 'h', col= 'yellow', xlab = 'Actual Temperature', ylab = 'Total Bike Rentals')
   
plot(bk_sh_dy$actual_feel_temp, bk_sh_dy$cnt ,type = 'h', col= 'yellow', xlab = 'Actual Feel Temperature', ylab = 'Total Bike Rentals')
   
plot(bk_sh_dy$actual_windspeed, bk_sh_dy$cnt ,type = 'h', col= 'yellow', xlab = 'Actual Windspeed', ylab = 'Total Bike Rentals')
   
plot(bk_sh_dy$actual_humidity, bk_sh_dy$cnt ,type = 'h', col= 'yellow', xlab = 'Actual Humidity', ylab = 'Total Bike Rentals')
```


# Scatter Plot between Bike Rentals and Actual Temperature

```{r}
library(ggplot2)

ggplot_Temp_Rent<- ggplot(bk_sh_dy, aes(x=actual_temp,y=cnt))+geom_point(shape=1)+geom_smooth(method=lm)+ xlab("Actual Temp. in Celcius")+ylab("Bike Rentals")
ggplot_Temp_Rent+scale_y_continuous(breaks=c(0,1100,2345,3500,5000,6000,7000,8000))+labs(title="Total Bike Rentals Vs Actual Temperature | Intercept = 2345")
```
# Linear Regression Model between Total Bike Rentals  versus Temperature
```{r}
lm_test<- lm(bk_sh_dy$cnt~bk_sh_dy$actual_temp)
summary(lm_test)
```
```{r}
#now plot ALL the graphs related to lm_test
plot(lm_test, col = "green")
```

From the linear regression between bike rentals (cnt) and actual temperature, we found that R-Squared value is at 40%, with p-value for actual temperature is at a significant level (i.e.   Pvalue<ALPHA,  where ALPHA is 10%, 5%, or 1%).

# Linear Regression Model between Total Bike Rentals  versus Temperature, Windspeed, and Humidity


```{r}
lm_test1<- lm(sqrt(bk_sh_dy$cnt)~bk_sh_dy$actual_temp+bk_sh_dy$actual_humidity+bk_sh_dy$actual_windspeed)

summary(lm_test1)
```


```{r}
lm_test2<- lm(((bk_sh_dy$cnt)^2)~        bk_sh_dy$actual_temp+bk_sh_dy$actual_humidity+bk_sh_dy$actual_windspeed)
summary(lm_test2)
```

```{r}
lm_test3<- lm((log(bk_sh_dy$cnt)) ~ bk_sh_dy$actual_temp+bk_sh_dy$actual_humidity+bk_sh_dy$actual_windspeed)

summary(lm_test3)
```

```{r}
lm_final<- lm(bk_sh_dy$cnt ~ bk_sh_dy$actual_temp  +bk_sh_dy$actual_humidity  +bk_sh_dy$actual_windspeed)

summary(lm_final)
```

```{r}

plot(lm_final,col = "gold", main = "Linear Regression: Bike Rentals, Temp, Windspeed and Humidity")
```


# Conclusion

We created various linear models and found the largest R-Squared value at 46% and all p-value for three variables were significant.

But checking the residual plot and QQ plot, we can see that the residuals have a pattern, and are not normally distributed, which means the linear model doesn’t fit the data so well.




# References


https://ww2.coastal.edu/kingw/statistics/R-tutorials/

http://www.cookbook-r.com/

https://archive.ics.uci.edu/ml/datasets/Bike+Sharing+Dataset

https://www.khanacademy.org/math/statistics-probability/describing-relationships-quantitative-data/residuals-least-squares-rsquared/a/introduction-to-residuals
